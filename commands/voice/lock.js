const { SlashCommandBuilder, EmbedBuilder } = require('discord.js');
const config = require('../../../config');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('voice-lock')
        .setDescription('–ó–∞–∫—Ä—ã—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–∞–Ω–∞–ª'),
    async execute(interaction) {
        const voiceChannel = interaction.member.voice.channel;

        if (!voiceChannel) {
            return interaction.reply({ 
                content: '‚ùå –í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –≥–æ–ª–æ—Å–æ–≤–æ–º –∫–∞–Ω–∞–ª–µ!', 
                ephemeral: true 
            });
        }

        if (!voiceChannel.permissionsFor(interaction.user).has('MANAGE_CHANNELS')) {
            return interaction.reply({ 
                content: '‚ùå –í—ã –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ —ç—Ç–∏–º –∫–∞–Ω–∞–ª–æ–º!', 
                ephemeral: true 
            });
        }

        try {
            await voiceChannel.permissionOverwrites.edit(interaction.guild.id, {
                CONNECT: false
            });

            const embed = new EmbedBuilder()
                .setColor(config.colors.success)
                .setTitle('üîí –ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç')
                .setDescription(`–ö–∞–Ω–∞–ª ${voiceChannel.name} —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã—Ç`)
                .setFooter({ text: `–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /voice-unlock –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è` });

            await interaction.reply({ embeds: [embed], ephemeral: true });
        } catch (error) {
            console.error(error);
            await interaction.reply({ 
                content: '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞–Ω–∞–ª–∞', 
                ephemeral: true 
            });
        }
    },
};